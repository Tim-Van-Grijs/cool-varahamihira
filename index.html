<!DOCTYPE html>
<html>
  <head>
    <title>GeeksforGeeks ChatRoom</title>
  </head>

  <body>
    <div class="container">
      <h1 class="logo">GeeksforGeeks ChatRoom</h1>
      <form class="form" id="form">
        <input class="input" type="text" placeholder="Name" id="myname" />
        <input class="input" type="text" placeholder="Message" id="message" />
        <button class="button">Send Message</button>
      </form>
      <div class="messageArea" id="messageArea"></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      let socket = io();
      let form = document.getElementById("form");
      let myname = document.getElementById("myname");
      let message = document.getElementById("message");
      let messageArea = document.getElementById("messageArea");

      // Display stored messages
      socket.on("send all messages", (messages) => {
        messages.forEach((msg) => {
          let chatContent = document.createElement("p");
          chatContent.classList.add("message");
          chatContent.innerHTML = `<span class="username">${msg.user}:</span> ${msg.message} 
                                   <span class="timestamp">(${msg.timestamp})</span>`;
          messageArea.appendChild(chatContent);
        });
      });

      // Send message
      form.addEventListener("submit", (e) => {
        e.preventDefault();
        let timestamp = new Date().toLocaleString(); // Get the current timestamp

        if (message.value) {
          let chatData = {
            user: myname.value,
            message: message.value,
            timestamp: timestamp,
          };

          socket.emit("send message", chatData); // Send to the server
          message.value = "";
        }
      });

      // Request messages when the page loads
      window.onload = () => {
        socket.emit("request messages"); // Request all messages from the server
      };
    </script>
  </body>
</html>
